%This file generates the plots and numerical performance measures, given the .mat files in the "Results"
%folder generated by "main.m"
%
for mod=[1,3,4]%go through all 3 initial conditions
load(['Results/traj_mod_' num2str(mod)])
close all
figure(1)
%title('closed loop traj')
hold on
if mod==1
plot(x_traj_nominal(1,:),x_traj_nominal(2,:),'black:','linewidth',2)
end
plot(x_traj_prop(1,:),x_traj_prop(2,:),'b-','linewidth',2)
if mod==1|| mod==2
plot(x_traj_soft_P(1,:),x_traj_soft_P(2,:),'r--','linewidth',2)
end
if mod==1||mod==2||mod==3
plot(x_traj_soft_T(1,:),x_traj_soft_T(2,:),'r:','linewidth',2)
end
plot(x_traj_soft_G(1,:),x_traj_soft_G(2,:),'g-.','linewidth',2)
X_set = Polyhedron(Ax, bx);
plot(X_set, 'color', 'b', 'alpha', 0.05)
if mod==1
    axis([-0.2,1.05,-1.1,1.05]); 
legend({'Nominal','Proposed','Soft-\textbf{P}','Soft-\textbf{T}','Soft-\textbf{G}'},'interpreter','latex','location','north')
elseif mod==2
    axis([-0.5,1.42,-1.7,1.4]); 
    legend({'Proposed','Soft-\textbf{P}','Soft-\textbf{T}','\textit{soft-\textbf{G}}'},'interpreter','latex','location','northwest')
elseif mod==3
    axis([-0.25,1.7,-1.2,1.6]); 
    legend({'Proposed','Soft-\textbf{T}','Soft-\textbf{G}'},'interpreter','latex','location','northwest')
elseif mod==4
        legend({'Proposed','Soft-\textbf{G}'},'interpreter','latex','location','northwest')
end
xlabel('$x_1$','interpreter','latex')
ylabel('$x_2$','interpreter','latex')
set(gca, 'fontname','Arial','fontsize',18)
print(['Plots/x_cl_' num2str(mod)],'-depsc')
end
%% Performance comparison
Perf=zeros(3,4);%save relative performance
text={'proposed';'soft-P';'soft-T';'soft-G'}';
mod=1;
load(['Results/traj_mod_' num2str(mod)])
Perf(1,:)=[sum(cost_traj_prop),sum(cost_traj_soft_P) sum(cost_traj_soft_T) sum(cost_traj_soft_G)]./sum(cost_traj_prop);
mod=3;
load(['Results/traj_mod_' num2str(mod)])
Perf(2,:)=[sum(cost_traj_prop),nan,sum(cost_traj_soft_T) sum(cost_traj_soft_G)]./sum(cost_traj_prop);
mod=4;
load(['Results/traj_mod_' num2str(mod)])
Perf(3,:)=[sum(cost_traj_prop),nan,nan,sum(cost_traj_soft_G)]./sum(cost_traj_prop);
Table_performance=table(Perf(:,1),Perf(:,2),Perf(:,3),Perf(:,4));
Table_performance.Properties.VariableNames{1}='Proposed';
Table_performance.Properties.VariableNames{2}='Soft-P';
Table_performance.Properties.VariableNames{3}='Soft-T';
Table_performance.Properties.VariableNames{4}='Soft-G';
display(Table_performance)
%% Computation times
load Results/comp_time
plot([t_nom(feasible),t_prop(feasible),t_G(feasible),t_T(feasible),t_P(feasible)])
legend('nominal', 'proposed','global','t','p')
Timing_ms={1e3*mean(t_nom(feasible)),1e3*mean(t_prop(feasible)),1e3*mean(t_P(feasible)),1e3*mean(t_T(feasible)),1e3*mean(t_G(feasible))};
%)*1e3%unit:ms
text={'nominal';'proposed';'soft-P';'soft-T';'soft-G'}';
Table_ms=table(text',Timing_ms');
Table_ms.Properties.VariableNames{1}='MPC';
Table_ms.Properties.VariableNames{2}='Time [ms]';
display(Table_ms)
